function [] = SDF_FR(varargin)
% This function shows the normalized amplitude of a single degree-of-freedom system
% as a function of the frequency ratio (r = excitation frequency/natural frequency).
% Several cases are presented:
%              -> Normalized Amplitude (HR - Norm. Amplitude)
%              -> Force Transmissibility (HR - Norm. Amplitude)
%              -> Displacement Transmissibility (BE - base exitation)
%              -> Force Transmissibility (BE - base exitation)
%              -> Normalized Amplitude (UR - unbalance response)
%
% Developed by Prof. Milton Dias Junior, PhD
%              Department of Integrated Systems
%              Faculty of Mechanical Engineering
%              State University of Campinas
%              São Paulo - Brazil
%              milton@fem.unicamp.br
%              April 25th, 2014

set(0,'Units','points');
screenrect = get(0,'screensize');
screenwidth = screenrect(3);
screenheigth = screenrect(4);
fig.width   = 410;
fig.heigth  = 425;
fig.left    = (screenwidth-fig.width)/2;
fig.bottom  = (screenheigth-fig.heigth)/2;
FIGPOSIT    = [fig.left fig.bottom fig.width fig.heigth];

[SnapData] = SnapshotCData;

linestylematrix = ['- ';'--';': ';'-.'];

switch length(varargin)
    case 0
        option = 'initialize';
        %         handles = [];
    case 1
        option = varargin{1};
        h = get(gcf,'UserData');
        Sn = 0;
    case 2
        option = varargin{1};
        AnaType = varargin{2};
        h = get(gcf,'UserData');
        Sn = 0;
    case 3
        option = varargin{1};
        h = get(gcf,'UserData');
        Sn = 1;
    otherwise
        h = msgbox('WRONG NUMBER OF INPUT ARGUMENTS!','INPUT ERROR','Error');
        uiwait(h);
        return;
end

COrder = [ 0    0    1.00
    1.00 0    0
    0    0.50 0
    0    0.75 0.75
    0.75 0    0.75
    0.75 0.75 0
    0.25 0.25 0.25];

FrameColor = [.60 .7 .74];

switch option
    case 'initialize'
        h_figs = get(0,'children');
        [mm,fig] = max(strcmp(get(h_figs','Name'),'MDJ // Single Degree of Freedom Frequency Simulator V2.0'));
        if(mm == 1); close(fig); end
        
        % Figure definition
        h0 = figure('Color',FrameColor, ...
            'Units','points',...
            'Name','MDJ // Single Degree of Freedom Frequency Simulator V2.0', ...
            'NumberTitle','off', ...
            'PaperPosition',[18 180 576 450], ...
            'PaperUnits','points', ...
            'Position',FIGPOSIT, ...
            'ToolBar','none',...
            'MenuBar','none');
        
        % Axes definition
        h1 = axes('Parent',h0, ...
            'Units','points', ...
            'Box','on', ...
            'CameraUpVector',[0 1 0], ...
            'CLimMode','auto', ...
            'Color',[1 1 1], ...
            'ColorOrder',COrder, ...
            'FontName','Times', ...
            'FontSize',9, ...
            'FontWeight','demi', ...
            'LineWidth',1, ...
            'LineStyleOrder',linestylematrix, ...
            'Position',[53 150 320 250], ...
            'Tag','Axes', ...
            'XColor',[0 0 0], ...
            'XGrid','on', ...
            'XLimMode','auto', ...
            'XTickLabelMode','auto', ...
            'XTickMode','auto', ...
            'YColor',[0 0 0], ...
            'YGrid','on', ...
            'YLimMode','auto', ...
            'YTickLabelMode','auto', ...
            'YTickMode','auto', ...
            'ZColor',[0 0 0]);
        xlabel('RAZÃO DE FREQUÊNCIAS','FontSize',10, ...
            'FontName','Times','FontWeight','demi')
        ylabel('NORMALIZED AMPLITUDE','FontSize',10, ...
            'FontName','Times','FontWeight','demi')
        
        % Frames and Titles
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'BackgroundColor',FrameColor, ...
            'ForegroundColor',[1 1 1], ...
            'ListboxTop',0, ...
            'Position',[6 45 128 55], ...
            'Style','frame');
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times''', ...
            'FontWeight','bold', ...
            'ListboxTop',0, ...
            'Position',[37.5 95 65 10], ...
            'String','INPUT DATA', ...
            'Style','text');
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'BackgroundColor',FrameColor, ...
            'ForegroundColor',[1 1 1], ...
            'ListboxTop',0, ...
            'Position',[143 10 124 90], ...
            'Style','frame');
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'ListboxTop',0, ...
            'Position',[172.5 95 75 10], ...
            'String','ANALYSIS TYPE', ...
            'Style','text');
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'BackgroundColor',FrameColor, ...
            'ForegroundColor',[1 1 1], ...
            'ListboxTop',0, ...
            'Position',[276 10 128 90], ...
            'Style','frame');
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'ListboxTop',0, ...
            'Position',[295 95 90 10], ...
            'String','GRAPHICS OPTIONS', ...
            'Style','text');
        
        % Input Data Options
        % Frequency Range
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'HorizontalAlignment','left', ...
            'ListboxTop',0, ...
            'Position',[10 75 70 10], ...
            'String','Frequency Range', ...
            'ToolTipString','Frequency Ratio Range (w/wn).', ...
            'Style','text');
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'Callback','SDF_FR(''FrequencyRange'');', ...
            'BackgroundColor',[1 1 1], ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'ListboxTop',0, ...
            'Position',[80 72.5 48 15], ...
            'String','0 3', ...
            'Style','edit', ...
            'Tag','FrequencyRange');
        % Damping Values
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'HorizontalAlignment','left', ...
            'ListboxTop',0, ...
            'Position',[10 55 70 10], ...
            'String','Damping Values', ...
            'ToolTipString','Damping Ration (in %).', ...
            'Style','text');
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'Callback','SDF_FR(''DampingValues'');', ...
            'BackgroundColor',[1 1 1], ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'ListboxTop',0, ...
            'Position',[80 52.5 48 15], ...
            'String','10:20:110', ...
            'Style','edit', ...
            'Tag','DampingValues');
        
        % Analysis Time
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'Callback','SDF_FR(''AnalysisType'',''HR - Norm. Amplitude'');', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'ListboxTop',0, ...
            'Position',[150 79 107 10], ...
            'String','HR - Norm. Amplitude', ...
            'Style','checkbox', ...
            'Tag','HR - Norm. Amplitude', ...
            'Value',1);
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'Callback','SDF_FR(''AnalysisType'',''HR - Force Transmissib.'');', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'ListboxTop',0, ...
            'Position',[150 63 107 10], ...
            'String','HR - Force Transmissib.', ...
            'Style','checkbox', ...
            'Tag','HR - Force Transmissib.');
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'Callback','SDF_FR(''AnalysisType'',''BE - Displ. Transmissib.'');', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'ListboxTop',0, ...
            'Position',[150 47 107 10], ...
            'String','BE - Displ. Transmissib.', ...
            'Style','checkbox', ...
            'Tag','BE - Displ. Transmissib.');
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'Callback','SDF_FR(''AnalysisType'',''BE - Force Transmissib.'');', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'ListboxTop',0, ...
            'Position',[150 31 105 10], ...
            'String','BE - Force Transmissib.', ...
            'Style','checkbox', ...
            'Tag','BE - Force Transmissib.');
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'Callback','SDF_FR(''AnalysisType'',''UR - Norm. Amplitude'');', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'ListboxTop',0, ...
            'Position',[150 15 107 10], ...
            'String','UR - Norm. Amplitude', ...
            'Style','checkbox', ...
            'Tag','UR - Norm. Amplitude');
        
        % Graphics Options
        % Y Scale
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'HorizontalAlignment','left', ...
            'ListboxTop',0, ...
            'Position',[283 75 40 10], ...
            'String','Y Scale', ...
            'Style','text');
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'Callback','SDF_FR(''YScale'');', ...
            'BackgroundColor',[1 1 1], ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'HorizontalAlignment','left', ...
            'ListboxTop',0, ...
            'Position',[330 72.5 65 15], ...
            'String',{'Linear';'dB rel(1)'}, ...
            'Style','popupmenu', ...
            'Tag','YScale', ...
            'Value',1);
        % Results
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'HorizontalAlignment','left', ...
            'ListboxTop',0, ...
            'Position',[283 55 40 10], ...
            'String','Results', ...
            'Style','text');
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'Callback','SDF_FR(''DataType'');', ...
            'BackgroundColor',[1 1 1], ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'HorizontalAlignment','left', ...
            'ListboxTop',0, ...
            'Position',[330 52.5 65 15], ...
            'String',{'Amplitude';'Phase'}, ...
            'Style','popupmenu', ...
            'Tag','DataType', ...
            'Value',1);
        
        % Plot Button
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'Callback','SDF_FR(''PLOT'');', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'FontSize',10, ...
            'ListboxTop',0, ...
            'Position',[75 13 59 20], ...
            'String','PLOT', ...
            'Tag','PLOT');
        % Reset Button
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'Callback','SDF_FR(''RESET'');', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'FontSize',10, ...
            'ListboxTop',0, ...
            'Position',[7 13 59 20], ...
            'String','RESET', ...
            'Tag','RESET');
        
        % Check boxes
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'Callback','SDF_FR(''Legend'');', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'ListboxTop',0, ...
            'Position',[283 35 45 10], ...
            'String','Legend', ...
            'Style','checkbox', ...
            'Tag','Legend');
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'Callback','SDF_FR(''Grid'');', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'ListboxTop',0, ...
            'Position',[283 15 45 10], ...
            'String','Grid', ...
            'Style','checkbox', ...
            'Tag','Grid', ...
            'Value',1);
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'Callback','SDF_FR(''PeakLine'');', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'ListboxTop',0, ...
            'Position',[335 35 58 10], ...
            'String','Peak Line', ...
            'Style','checkbox', ...
            'Tag','PeakLine');
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'Callback','SDF_FR(''PeakMark'');', ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'FontWeight','bold', ...
            'ListboxTop',0, ...
            'Position',[335 15 58 10], ...
            'String','Peak Mark', ...
            'Style','checkbox', ...
            'Tag','PeakMark');
        
        % Snapshot
        uicontrol('Parent',h0, ...
            'Units','points', ...
            'Callback','SDF_FR(''PLOT'',1,1);', ...
            'CData',SnapData, ...
            'BackgroundColor',FrameColor, ...
            'FontName','Times', ...
            'ListboxTop',0, ...
            'Position',[383 405 20 15], ...
            'String','', ...
            'Tag','Snap');
        
        % Menus
        h_file      = uimenu(gcf   ,'Label'   ,'File');
        h_new       = uimenu(h_file,'Label'   ,'New');
        h_frequency = uimenu(h_new ,'Label'   ,'Frequency Module', ...
            'Callback','SDF_FR_new(''initialize'');');
        h_time      = uimenu(h_new ,'Label'   ,'Time Module', ...
            'Callback','SDF_TM2(''initialize'');');
        h_exit      = uimenu(h_file,'Label'   ,'Exit', ...
            'Callback','SDF_FR_new(''Exit'');', ...
            'Separator','on');
        
        h_help       = uimenu(gcf   ,'Label'   ,'Help');
        h_frequencyh = uimenu(h_help,'Label'   ,'Frequency Module', ...
            'Callback','SDF_FR2(''HelpFrequency'');');
        h_timeh      = uimenu(h_help,'Label'   ,'Time Module', ...
            'Callback','SDF_FR_new(''HelpTime'');');
        h_about      = uimenu(h_help,'Label'   ,'About SDF Simulator', ...
            'Callback','SDF_FR_new(''About'');', ...
            'Separator','on');
        
        h.h0 = [];
        h.h1 = [];
        set(gcf,'UserData',h);
        
    case 'AnalysisType'
        analysishandles = {'HR - Norm. Amplitude'; ...
            'HR - Force Transmissib.'; ...
            'BE - Displ. Transmissib.'; ...
            'BE - Force Transmissib.'; ...
            'UR - Norm. Amplitude'};
        for ah = 1:5
            set(findobj(gcbf,'Tag',analysishandles{ah}),'Value',0);
        end
        set(findobj(gcbf,'Tag',AnaType),'Value',1);
        if(get(findobj(gcbf,'Tag','BE - Force Transmissib.'),'Value') == 1)
            set(findobj(gcbf,'Tag','PeakMark'),'Enable','off');
            set(findobj(gcbf,'Tag','PeakLine'),'Enable','off');
            set(findobj(gcbf,'Tag','PeakMark'),'Value',0);
            set(findobj(gcbf,'Tag','PeakLine'),'Value',0);
        else
            set(findobj(gcbf,'Tag','PeakMark'),'Enable','on');
            set(findobj(gcbf,'Tag','PeakLine'),'Enable','on');
        end
        
    case 'Grid'
        if(get(findobj(gcbf,'Tag','Grid'),'Value') == 1)
            grid on
        else
            grid off
        end
        
    case 'Legend'
        if(isempty(h.h0))
            return
        else
            if(get(findobj(gcbf,'Tag','Legend'),'Value') == 1)
                leg_str = num2str(str2num(get(findobj(gcbf,'Tag','DampingValues'),'String'))'); %#ok<ST2NM>
                legend(h.h1,leg_str);
            else
                legend off;
            end
        end
        
    case {'PeakLine';'PeakMark';'YScale'}
        if(isempty(h.h0))
            return
        else
            SDF_FR('PLOT');
        end
        
    case 'DataType'
        if(get(findobj(gcbf,'Tag','DataType'),'Value') == 1)
            set(findobj(gcbf,'Tag','YScale'),'Enable','on');
        else
            set(findobj(gcbf,'Tag','YScale'),'Value',1);
            set(findobj(gcbf,'Tag','YScale'),'Enable','off');
        end
        if(isempty(h.h0))
            return
        else
            SDF_FR('PLOT');
        end
        
    case 'RESET'
        set(findobj(gcbf,'Tag','FrequencyRange'),'String','0 3');
        set(findobj(gcbf,'Tag','DampingValues'),'String','10:20:110');
        set(findobj(gcbf,'Tag','HR - Norm. Amplitude'),'Value',1);
        set(findobj(gcbf,'Tag','HR - Force Transmissib.'),'Value',0);
        set(findobj(gcbf,'Tag','BE - Displ. Transmissib.'),'Value',0);
        set(findobj(gcbf,'Tag','BE - Force Transmissib.'),'Value',0);
        set(findobj(gcbf,'Tag','UR - Norm. Amplitude'),'Value',0);
        
    case 'PLOT'
        rv  = str2num(get(findobj(gcbf,'Tag','FrequencyRange'),'String')); %#ok<ST2NM>
        r = rv(1):(rv(2)-rv(1))/5000:rv(2);
        z  = str2num(get(findobj(gcbf,'Tag','DampingValues'),'String'))/100; %#ok<ST2NM>
        
        X = zeros(length(z),length(r));
        
        for dv = 1:length(z)
            if(get(findobj(gcbf,'Tag','HR - Norm. Amplitude'),'Value') == 1)
                X(dv,:) = 1./((1-r.^2)+1i*2*z(dv)*r);                           % HR - Norm. Amplitude Eq(2.**)
                Tit = 'Amplitude Normalizada - Excitação Externa Harmônica';
            elseif(get(findobj(gcbf,'Tag','HR - Force Transmissib.'),'Value') == 1)
                X(dv,:) = (1+1i*2*z(dv)*r)./((1-r.^2)+1i*2*z(dv)*r);
                Tit = 'Transmissibilidade de Força - Excitação Externa Harmônica';
            elseif(get(findobj(gcbf,'Tag','BE - Displ. Transmissib.'),'Value') == 1)
                X(dv,:) = (1+1i*2*z(dv)*r)./((1-r.^2)+1i*2*z(dv)*r);
                Tit = 'Transmissibilidade de Deslocamento - Excitação pela Base';
            elseif(get(findobj(gcbf,'Tag','BE - Force Transmissib.'),'Value') == 1)
                X(dv,:) = (r.^2).*(1+1i*2*z(dv)*r)./((1-r.^2)+1i*2*z(dv)*r);
                Tit = 'Transmissibilidade de Força - Excitação pela Base';
            elseif(get(findobj(gcbf,'Tag','UR - Norm. Amplitude'),'Value') == 1)
                X(dv,:) = (r.^2)./((1-r.^2)+1i*2*z(dv)*r);
                Tit = 'Amplitude Normalizada - Resposta ao Desbalanço';
            end
        end
        
        Xn = zeros(length(z),length(r));
        if(get(findobj(gcbf,'tag','DataType'),'value') == 2)
            Xn = -angle(X)*180/pi;
            Xn(z==0,:) = - Xn(z==0,:);
            TitText = 'FASE [DEG]';
        else
            Xn = abs(X);
            TitText = 'AMPLITUDE NORMALIZADA';
        end
        
        if(get(findobj(gcbf,'Tag','YScale'),'Value') == 2)
            Xn = 20*log10(Xn);
        end
        
        if(Sn == 1)
            h.h0 = figure;
            set(h.h0,'Color','w');
            h.h1 = axes('Parent',h.h0, ...
                'Units','points', ...
                'Box','on', ...
                'CameraUpVector',[0 1 0], ...
                'CLimMode','auto', ...
                'Color',[1 1 1], ...
                'ColorOrder',COrder, ...
                'FontName','Times', ...
                'FontSize',8, ...
                'LineWidth',1, ...
                'Tag','AxesTime', ...
                'XColor',[0 0 0], ...
                'XGrid','on', ...
                'XLimMode','auto', ...
                'XTickLabelMode','auto', ...
                'XTickMode','auto', ...
                'YColor',[0 0 0], ...
                'YGrid','on', ...
                'YLimMode','auto', ...
                'YTickLabelMode','auto', ...
                'YTickMode','auto', ...
                'ZColor',[0 0 0]);
        else
            
            h.h0 = gcf;
            if(isempty(h.h1))
                h.h1 = gca;
            else
                axes(h.h1);
                cla reset;
            end
        end
        
        line(r,Xn,'LineWidth',1.5);
        h.h1 = get(gcf,'CurrentAxes');
        set(h.h1,'XColor','k','YColor','k','Box','on', ...
            'FontWeight','demi','FontSize',10);
        lims = axis;
        
        if(get(findobj(gcbf,'Tag','PeakLine'),'Value') == 1)
            if(get(findobj(gcbf,'Tag','HR - Norm. Amplitude'),'Value') == 1)
                zp = 0.01:.05:1/sqrt(2);
                rp = sqrt(1-2*zp.^2);
                for dp = 1:length(zp)
                    Xp(dp) = abs(1/((1-rp(dp)^2)+1i*2*zp(dp)*rp(dp)));
                end
            elseif(get(findobj(gcbf,'Tag','HR - Force Transmissib.'),'Value') == 1)
                zp = 0.01:.05:10;
                rp = sqrt(-1+sqrt(1+8*zp.^2))./(2*zp);
                for dp = 1:length(zp)
                    Xp(dp) = abs((1+1i*2*zp(dp)*rp(dp))/((1-rp(dp)^2)+1i*2*zp(dp)*rp(dp)));
                end
            elseif(get(findobj(gcbf,'Tag','BE - Displ. Transmissib.'),'Value') == 1)
                zp = 0.01:.05:10;
                rp = sqrt(-1+sqrt(1+8*zp.^2))./(2*zp);
                for dp = 1:length(zp)
                    Xp(dp) = abs((1+1i*2*zp(dp)*rp(dp))/((1-rp(dp)^2)+1i*2*zp(dp)*rp(dp)));
                end
            elseif(get(findobj(gcbf,'Tag','UR - Norm. Amplitude'),'Value') == 1)
                zp = 0.01:.05:1/sqrt(2);
                rp = 1./sqrt(1-2*zp.^2);
                for dp = 1:length(zp)
                    Xp(dp) = abs((rp(dp)^2)/((1-rp(dp)^2)+1i*2*zp(dp)*rp(dp)));
                end
            end
            
            if(get(findobj(gcbf,'Tag','YScale'),'Value') == 2)
                Xp = 20*log10(Xp);
            end
            
            lims = axis;
            line(rp,Xp,'Color','r','LineStyle','--','LineWidth',1.5);
            axis(lims)
        end
        
        clear Xp zp rp;
        
        if(get(findobj(gcbf,'Tag','PeakMark'),'Value') == 1)
            if(get(findobj(gcbf,'Tag','HR - Norm. Amplitude'),'Value') == 1)
                zp = z(z<= 1/sqrt(2));
                rp = sqrt(1-2*zp.^2);
                for dp = 1:length(zp)
                    Xp(dp) = abs(1/((1-rp(dp)^2)+1i*2*zp(dp)*rp(dp)));
                end
            elseif(get(findobj(gcbf,'Tag','HR - Force Transmissib.'),'Value') == 1)
                zp = z;
                rp = sqrt(-1+sqrt(1+8*zp.^2))./(2*zp);
                for dp = 1:length(zp)
                    Xp(dp) = abs((1+1i*2*zp(dp)*rp(dp))/((1-rp(dp)^2)+1i*2*zp(dp)*rp(dp)));
                end
            elseif(get(findobj(gcbf,'Tag','BE - Displ. Transmissib.'),'Value') == 1)
                zp = z;
                rp = sqrt(-1+sqrt(1+8*zp.^2))./(2*zp);
                for dp = 1:length(zp)
                    Xp(dp) = abs((1+1i*2*zp(dp)*rp(dp))/((1-rp(dp)^2)+1i*2*zp(dp)*rp(dp)));
                end
            elseif(get(findobj(gcbf,'Tag','UR - Norm. Amplitude'),'Value') == 1)
                zp = z(z<= 1/sqrt(2));
                rp = 1./sqrt(1-2*zp.^2);
                for dp = 1:length(zp)
                    Xp(dp) = abs((rp(dp)^2)/((1-rp(dp)^2)+1i*2*zp(dp)*rp(dp)));
                end
            end
            if(get(findobj(gcbf,'Tag','YScale'),'Value') == 2)
                Xp = 20*log10(Xp);
            end
            
            hold on
            lims = axis;
            if exist('rp','var')
                plot(rp,Xp,'Color','r','LineStyle','none','Marker','*','LineWidth',1.5);
                axis(lims)
                hold off
            end
        end
        
        if(get(findobj(gcbf,'Tag','Grid'),'Value') == 1); grid on; end
        if(get(findobj(gcbf,'Tag','Legend'),'Value') == 1); legend(h.h1,num2str(100*z')); end
        
        hx = text('Parent',h.h1, ...
            'Color',[0 0 0], ...
            'HandleVisibility','off', ...
            'HorizontalAlignment','center', ...
            'Tag','XLabel', ...
            'VerticalAlignment','top', ...
            'FontSize',10, ...
            'FontWeight','demi', ...
            'FontName','Times', ...
            'String','RAZÃO DE FREQUÊNCIAS');
        set(h.h1,'XLabel',hx);
        hy = text('Parent',h.h1, ...
            'Color',[0 0 0], ...
            'HandleVisibility','off', ...
            'HorizontalAlignment','center', ...
            'Tag','YLabel', ...
            'VerticalAlignment','bottom', ...
            'FontSize',10, ...
            'FontWeight','demi', ...
            'FontName','Times', ...
            'String',TitText);
        set(h.h1,'YLabel',hy);
        x = get(gca,'XLim');
        y = get(gca,'YLim');
        xm = (x(2)-x(1))/2;
        ht = text('Parent',h.h1, ...
            'Color',[0 0 0], ...
            'HandleVisibility','off', ...
            'HorizontalAlignment','center', ...
            'Position',[xm y(2)], ...
            'Tag','Title', ...
            'VerticalAlignment','bottom', ...
            'FontSize',10, ...
            'FontName','Arial', ...
            'FontWeight','demi', ...
            'String',Tit);
        set(h.h1,'Title',ht)
        
        if(Sn ~= 1); set(gcf,'UserData',h); end
        
    case 'Exit'
        close(gcf)
        
end

function [SnapData] = SnapshotCData()

SnapData(:,:,1) = [
  191  191  191  191  191  191  191  191  191  127  127  127  127  127  191  191  191  191  191  191  191   191  191  191
  191  191  191  191  191  191  191  191  191  127  191  255  191  255  127  191  191  191  127  127  127     0    0  191
  191  191    0    0    0  127  191  191  127  191  255  191  255  191  255  127  191  191  127  191  255   127    0  191
  127  127  127  127  127  127  127  127  127  127  127  127    0    0    0    0    0    0    0    0    0     0    0  127
  127  127    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0     0    0  127
    0  127  255  255  255  255  191  191  127  191  255  191  255  191  127  127  127  191  127  191  127   191  127  127
    0  191  127    0    0  127  127  127  255  255  127    0    0  127  255    0    0    0    0    0    0     0    0  127
    0  127  127    0    0  127  127  255  255  127    0    0    0    0  127  191    0    0    0  127    0   127    0  127
    0  191    0  127  127    0  127  255    0    0    0  255  191    0    0  127  191    0  127    0  127     0    0  127
    0  127  127    0    0    0  191  255    0    0  255    0    0    0    0    0  127    0    0  127    0   127    0  127
    0  191  127    0    0    0  191  255    0    0  255    0    0    0    0    0  191    0    0    0  127     0    0  127
    0  127    0  127  127    0  127  255    0    0  191    0    0    0    0    0  191    0    0  127    0   127    0  127
    0  191  127    0    0  127  127  255  255    0    0    0    0    0    0  127  127    0    0    0  127     0    0  127
    0  127  127    0    0  127  127  127  255  255    0    0    0    0  127  255    0    0    0  127    0   127    0  127
    0  191  255  255  255  191  191  127  127  191  255  191  255  191  191    0    0  191  127  191  127   191    0  127
  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127   127  127  127
    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0     0    0  127];

SnapData(:,:,2) = [
  191  191  191  191  191  191  191  191  191  127  127  127  127  127  191  191  191  191  191  191  191   191  191  191
  191  191  191  191  191  191  191  191  191  127  191  255  191  255  127  191  191  191  127  127  127     0    0  191
  191  191    0    0    0  127  191  191  127  191  255  191  255  191  255  127  191  191  127  191  255   127    0  191
  127  127  127  127  127  127  127  127  127  127  127  127    0    0    0    0    0    0    0    0    0     0    0  127
  127  127    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0     0    0  127
    0  127  255  255  255  255  191  191  127  191  255  191  255  191  127  127  127  191  127  191  127   191  127  127
    0  191  127    0    0  127  127  127  255  255  127    0    0  127  255    0    0    0    0    0    0     0    0  127
    0  127  127    0    0  127  127  255  255  127    0    0    0    0  127  191    0    0    0  127    0   127    0  127
    0  191    0  127  127    0  127  255    0    0    0  255  191    0    0  127  191    0  127    0  127     0    0  127
    0  127  127    0    0    0  191  255    0    0  255    0    0    0    0    0  127    0    0  127    0   127    0  127
    0  191  127    0    0    0  191  255    0    0  255    0    0    0    0    0  191    0    0    0  127     0    0  127
    0  127    0  127  127    0  127  255    0    0  191    0    0    0    0    0  191    0    0  127    0   127    0  127
    0  191  127    0    0  127  127  255  255    0    0    0    0    0    0  127  127    0    0    0  127     0    0  127
    0  127  127    0    0  127  127  127  255  255    0    0    0    0  127  255    0    0    0  127    0   127    0  127
    0  191  255  255  255  191  191  127  127  191  255  191  255  191  191    0    0  191  127  191  127   191    0  127
  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127   127  127  127
    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0     0    0  127];

SnapData(:,:,3) = [
  191  191  191  191  191  191  191  191  191  127  127  127  127  127  191  191  191  191  191  191  191   191  191  191
  191  191  191  191  191  191  191  191  191  127  191  255  191  255  127  191  191  191  127  127  127     0    0  191
  191  191    0    0    0  127  191  191  127  191  255  191  255  191  255  127  191  191  127  191  255   127    0  191
  127  127  127  127  127  127  127  127  127  127  127  127    0    0    0    0    0    0    0    0    0     0    0  127
  127  127    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0     0    0  127
    0  127  255  255  255  255  191  191  127  191  255  191  255  191  127  127  127  191  127  191  127   191  127  127
    0  191  127    0    0  127  127  127  255  255  127    0    0  127  255    0    0    0    0    0    0     0    0  127
    0  127  127    0    0  127  127  255  255  127    0    0    0    0  127  191    0    0    0  127    0   127    0  127
    0  191    0  127  127    0  127  255    0    0    0  255  191    0    0  127  191    0  127    0  127     0    0  127
    0  127  127    0    0    0  191  255    0    0  255    0    0    0    0    0  127    0    0  127    0   127    0  127
    0  191  127    0    0    0  191  255    0    0  255    0    0    0    0    0  191    0    0    0  127     0    0  127
    0  127    0  127  127    0  127  255    0    0  191    0    0    0    0    0  191    0    0  127    0   127    0  127
    0  191  127    0    0  127  127  255  255    0    0    0    0    0    0  127  127    0    0    0  127     0    0  127
    0  127  127    0    0  127  127  127  255  255    0    0    0    0  127  255    0    0    0  127    0   127    0  127
    0  191  255  255  255  191  191  127  127  191  255  191  255  191  191    0    0  191  127  191  127   191    0  127
  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127  127   127  127  127
    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0     0    0  127];

SnapData = SnapData/max(max(max(SnapData)));